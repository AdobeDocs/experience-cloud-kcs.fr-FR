---
title: Utilisation et compréhension des variables
description: Description
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: 10/21/2021 5:36:09 PM
article-published-by: Cedric Latimier
article-published-date: 1/18/2022 1:51:43 PM
version-number: 1
article-number: KA-17487
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=1280b65e-9532-ec11-b6e5-000d3a5ba97a
exl-id: 86b5580e-134f-40d7-a126-45a38b8beaec
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '926'
ht-degree: 1%

---

# Utilisation et compréhension des variables

## Description


Ce document explique comment tirer parti de la puissance des variables dans [!DNL Apache] serveur web et dans vos fichiers de configuration de module de Dispatcher.
<br><br><br><br>Variables<br><br><br><br> <br><br>
[!DNL Apache] prend en charge les variables et depuis la version 4.1.9 du [!DNL Dispather] module il les prend également en charge.

Nous pouvons les exploiter pour réaliser une tonne de choses utiles telles que :

- Assurez-vous que tout ce qui est spécifique à l’environnement n’est pas en ligne dans les configurations, mais extrait pour vous assurer que les fichiers de configuration du développement fonctionnent en production avec la même sortie fonctionnelle.
- Active/désactive les fonctionnalités et modifie les niveaux de journal des fichiers non modifiables fournis par AMS et ne vous permet pas de modifier.
- Modifier les inclusions à utiliser en fonction de variables comme `RUNMODE` et `ENV_TYPE`
- Correspondance `DocumentRoot`s et `VirtualHost` Noms DNS entre [!DNL Apache] configurations et configurations de module.



## Résolution

<br><br>Utilisation des variables de ligne de base<br><br><br><br> <br><br>
Étant donné que les fichiers de ligne de base AMS sont en lecture seule et immuables, il existe des fonctionnalités qui peuvent être activées et désactivées et configurées en modifiant les variables qu’elles utilisent.
<br><br><br><br> <br><br>Variables de ligne de base<br><br><br><br> <br><br>
Voici un exemple du contenu du fichier : <b>`/etc/httpd/conf.d/variables/ams_default.vars`</b>
<br><br><br><br><br> <br><br><br><br>

` Define DISP_LOG_LEVEL info Define AUTHOR_WHITELIST_ENABLED 0 Define PUBLISH_WHITELIST_ENABLED 0 Define AUTHOR_FORCE_SSL 1 Define PUBLISH_FORCE_SSL 0 `

<br><br><br><br><br> <br><br>Exemple 1 - Forcer SSL<br><br><br><br> <br><br>
Les variables affichées ci-dessus <b>`AUTHOR_FORCE_SSL`</b>ou <b>`PUBLISH_FORCE_SSL`</b> peut être défini sur 1 pour activer les règles de réécriture qui forcent les utilisateurs finaux à être redirigés vers https lorsqu’ils arrivent sur une requête http.

Voici la syntaxe du fichier de configuration qui permet à ce bouton de fonctionner :
<br><br><br><br><br> <br><br><br><br>

`/VirtualHost *:80      IfModule mod_rewrite.c          ReWriteEngine    on          If "${PUBLISH_FORCE_SSL} == 1" Include /etc/httpd/conf.d/rewrites/forcessl_rewrite.rules          /If      /IfModule /VirtualHost`

<br><br><br><br><br> <br><br>
Comme vous pouvez le constater, les règles de réécriture incluent le code permettant de rediriger le navigateur des utilisateurs finaux, mais la variable définie sur 1 permet d’utiliser ou non le fichier.
<br><br><br><br> <br><br>Exemple 2 - Niveau de journalisation<br><br><br><br> <br><br>
Les variables <b>`DISP_LOG_LEVEL`</b> peut être utilisé pour définir ce que vous souhaitez avoir pour le niveau de journal réellement utilisé dans la configuration en cours d’exécution.

Voici l’exemple de syntaxe qui existe dans les fichiers de configuration de ligne de base ams :
<br><br><br><br><br> <br><br><br><br>

`IfModule disp_apache2.c      DispatcherLog    logs/dispatcher.log      DispatcherLogLevel ${DISP_LOG_LEVEL} /IfModule`

<br><br><br><br><br> <br><br>
Si vous devez augmenter le niveau de journalisation du dispatcher, mettez à jour la variable `ams_default.vars` variable <b>`DISP_LOG_LEVEL`</b> au niveau que vous souhaitez.

Les exemples de valeurs peuvent être un entier ou le mot :
<br><br><br><br> <br>

| Niveau de journal | Valeur entière | Valeur Word |
| --- | --- | --- |
| Trace | 4 | trace |
| Déboguer | 3 | debug |
| Infos | 2 | info |
| Avertissement | 1 | warn |
| Erreur | 0 | error |

<br><br><br> <br><br>Exemple 3 - Listes autorisées<br><br><br><br> <br><br>
Les variables <b>`AUTHOR_WHITELIST_ENABLED`</b> et <b>`PUBLISH_WHITELIST_ENABLED`</b> peut être défini sur 1 pour appliquer des règles de réécriture qui incluent des règles permettant d’autoriser ou d’interdire le trafic d’utilisateurs finaux en fonction de leur adresse IP.  Le fait d’activer cette fonction doit être combiné à la création d’un fichier de règles de liste autorisée pour qu’il soit inclus.

Voici quelques exemples de syntaxe sur la manière dont la variable active les inclusions des fichiers de liste autorisée et un exemple de fichier de liste autorisée.

<b>`sample.vhost`:</b>
<br><br><br><br><br> <br><br><br><br>

`VirtualHost *:80      Directory /          If "${AUTHOR_WHITELIST_ENABLED} == 1"              Include /etc/httpd/conf.d/whitelists/*_whitelist.rules          /If      /Directory /VirtualHost`

<br><br><br><br><br> <br><br>
<b>`sample_whitelist.rules`</b>:
<br><br><br><br><br> <br><br><br><br>

`RequireAny    Require ip 10.43.0.10/24 /RequireAny`

<br><br><br><br><br> <br><br>
Comme vous pouvez le voir *`sample_whitelist.rules`* applique la restriction IP, mais le fait de changer de variable permet de l’inclure dans la variable *`sample.vhost`*
<br><br><br><br> <br><br>Où placer les variables<br><br><br><br> <br><br>Arguments de démarrage du serveur web<br><br><br><br> <br><br>
AMS placera des variables globales dans les arguments de démarrage de la variable [!DNL Apache] processus dans le fichier <b>`/etc/sysconfig/httpd`</b>

Ce fichier comporte des variables prédéfinies, comme illustré ci-dessous :
<br><br><br><br><br> <br><br><br><br>

AUTHOR_IP=&quot;10.43.0.59&quot; AUTHOR_PORT=&quot;4502&quot; AUTHOR_DOCROOT=&#39;/mnt/var/www/author&#39; PUBLISH_IP=&quot;10.43.0.20&quot; PUBLISH_PORT=&quot;4503&quot; PUBLISH_DOCROOT=&#39;/mnt/var/www/html&#39; ENV_TYPE=&#39;dev&#39; UNMODE=&#39;dev&#39;

<br><br><br><br><br> <br><br>
Il ne s’agit pas d’éléments que vous pouvez modifier, mais que vous pouvez exploiter dans vos fichiers de configuration.

Remarque :

En raison du fait que ce fichier n’est inclus que lorsque le service démarre.  Un redémarrage du service est nécessaire pour récupérer les modifications.  Cela signifie qu’une recharge n’est pas suffisante, mais qu’un redémarrage est nécessaire.


<br><br><br><br> <br><br>Fichiers variables (`.vars`)<br><br><br><br> <br><br>
Les variables personnalisées fournies par votre code doivent se trouver dans *`.vars`*fichiers dans le répertoire <b>`/etc/httpd/conf.d/variables/`</b>

Ces fichiers peuvent avoir toutes les variables personnalisées que vous souhaitez et vous trouverez quelques exemples de syntaxe dans les exemples de fichiers suivants :

<b>`/etc/httpd/conf.d/variables/weretail_domains_dev.vars`</b>:
<br><br><br><br><br> <br><br><br><br>

`Define WERETAIL_DOMAIN dev.weretail.com Define WERETAIL_ALT_DOMAIN dev.weretail.net`

<br><br><br><br><br> <br><br>
<b>`/etc/httpd/conf.d/variables/weretail_domains_stage.vars`:</b>
<br><br><br><br><br> <br><br><br><br>

`Define WERETAIL_DOMAIN stage.weretail.com` `Define WERETAIL_ALT_DOMAIN stage.weretail.net`


<br><br><br><br><br> <br><br>
<b>`/etc/httpd/conf.d/variables/weretail_domains_prod.vars`</b>:
<br><br><br><br><br> <br><br><br><br>

`Define WERETAIL_DOMAIN www.weretail.com Define WERETAIL_ALT_DOMAIN www..weretail.net`

<br><br><br><br><br> <br><br>
Lors de la création de vos propres fichiers de variables, nommez-les en fonction de leur contenu et de respecter les normes d’attribution de noms fournies dans le manuel. [here](https://helpx.adobe.com/experience-manager/kb/ams-dispatcher-manual/explanation-config-files.html#naming-convention).  Dans l’exemple ci-dessus, vous pouvez constater que le fichier de variables héberge les différentes entrées DNS en tant que variables à utiliser dans les fichiers de configuration.
<br><br><br><br> <br><br>Utilisation de variables<br><br><br><br> <br><br>
Maintenant que vous avez défini vos variables dans vos fichiers de variables, vous allez savoir comment les utiliser correctement dans vos autres fichiers de configuration.

Nous utiliserons l’exemple `.vars` fichiers ci-dessus pour illustrer un cas d’utilisation approprié.

Nous voulons inclure toutes les variables basées sur l’environnement globalement ; nous allons créer le fichier . <b>`/etc/httpd/conf.d/000_load_env_vars.conf`</b>

`Include /etc/httpd/conf.d/variables/*_${ENV_TYPE}.vars Include /etc/httpd/conf.d/variables/*_${RUNMODE}.vars`

<br><br><br><br><br> <br><br>
Nous savons que lorsque le service httpd démarre, il extrait les variables définies par AMS dans <b>`/etc/sysconfig/httpd`</b> et possède le jeu de variables de <b>`ENV_TYPE`</b> et <b>`RUNMODE`</b>

Lorsque cette variable est globale `.conf` est extrait plus tôt, car l’ordre d’inclusion des fichiers dans `conf.d` est un ordre de chargement alphanumérique signifiant 000 dans le nom du fichier assure qu&#39;il se charge avant les autres fichiers du répertoire.

L’instruction d’inclusion utilise également une variable dans le nom de fichier.  Cela peut modifier le fichier qu’il chargera en fonction de la valeur contenue dans la variable `ENV_TYPE` et `RUNMODE` .

Si la variable *`ENV_TYPE`* la valeur est <b>`dev`</b> puis le fichier utilisé est :

<b>`/etc/httpd/conf.d/variables/weretail_domains_dev.vars`</b>

Si la variable *`ENV_TYPE`* la valeur est <b>`stage`</b> puis le fichier utilisé est :

<b>`/etc/httpd/conf.d/variables/weretail_domains_stage.vars`</b>

Si la variable `RUNMODE` la valeur est <b>`preview`</b> puis le fichier utilisé est :

<b>`/etc/httpd/conf.d/variables/weretail_domains_preview.vars`</b>

Lorsque ce fichier sera inclus, il nous permettra d’utiliser les noms de variables qui étaient stockés à l’intérieur.

Dans notre <b>`/etc/httpd/conf.d/available_vhosts/weretail.vhost`</b> Nous pouvons remplacer la syntaxe normale qui ne fonctionnait que pour dev :


```
VirtualHost *:80      ServerName    dev.weretail.com      ServerAlias    dev.weretail.net |
```

Avec une syntaxe plus récente qui utilise la puissance des variables pour fonctionner pour le développement, l’évaluation et la production :

```
VirtualHost *:80      ServerName    ${WERETAIL_DOMAIN}      ServerAlias    ${WERETAIL_ALT_DOMAIN}
```


Dans notre <b>`/etc/httpd/conf.dispatcher.d/vhosts/weretail_vhosts.any`</b> Nous pouvons remplacer la syntaxe normale qui ne fonctionnait que pour dev :


```
"dev.weretail.com" "dev.weretail.net"
```


Avec une syntaxe plus récente qui utilise la puissance des variables pour fonctionner pour dev, stage et prod :


```
"${WERETAIL_DOMAIN}" "${WERETAIL_ALT_DOMAIN}" 
```

<br><br><br><br><br> <br><br>
Ces variables sont réutilisées pour personnaliser considérablement les paramètres d’exécution sans avoir à déployer différents fichiers par environnement.  Vous pouvez essentiellement modéliser vos fichiers de configuration à l’aide de variables et inclure des fichiers en fonction de variables.
