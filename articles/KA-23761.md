---
title: « Avertissement ResourceResolver non fermé à com.day.cq.search.impl.builder.QueryBuilderImpl »
description: « Découvrez comment résoudre l’avertissement ResourceResolver non fermé à l’adresse com.day.cq.search.impl.builder.QueryBuilderImpl. »
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager 6.5"
keywords: « KCS, avertissement ResourceResolver non fermé, API QueryBuilder, AEM 6.5, Adobe Experience Manager 6.5, dépannage, com.day.cq.search.impl.builder.QueryBuilderImpl »
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Jim Menn
article-created-date: "4/8/2024 8:45:29 PM"
article-published-by: Jim Menn
article-published-date: "4/8/2024 8:46:39 PM"
version-number: 2
article-number: KA-23761
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=a902a6e9-e8f5-ee11-a1fe-6045bd006268"
source-git-commit: e28c723365d87e315c6ab784233e3700bd57d9be
workflow-type: tm+mt
source-wordcount: '291'
ht-degree: 1%

---

# Avertissement de ResourceResolver non fermé à com.day.cq.search.impl.builder.QueryBuilderImpl


Découvrez comment résoudre l’avertissement ResourceResolver non fermé à l’adresse com.day.cq.search.impl.builder.QueryBuilderImpl.

## Description {#description}


### Environnement

AEM 6.5

### Problème/Symptômes

Un avertissement de session non fermée apparaît dans les journaux provenant de la classe QueryBuilderImpl : `11.01.2018 01:03:18.878 *INFO* [ Apache Sling Resource Resolver Finalizer Thread]`
<br><br><br>11.01.2018 01:03:18,878 \*INFO\* `[` Thread de finalisation du résolveur de ressource Apache Sling`]`  org.apache.sling.resourceresolver.impl.CommonResourceResolverFactoryImpl Unclosed ResourceResolver a été créé ici : <br><br><br><br>java.lang.Exception : ouverture de la trace de pile<br><br><br><br>à org.apache.sling.resourceresolver.impl.CommonResourceResolverFactoryImpl$ResolverReference.`<` init`>` (CommonResourceResolverFactoryImpl.java:521)<br><br><br><br>à org.apache.sling.resourceresolver.impl.CommonResourceResolverFactoryImpl.register(CommonResourceResolverFactoryImpl.java:218)<br><br><br><br>à org.apache.sling.resourceresolver.impl.ResourceResolverImpl.`<` init`>` (ResourceResolverImpl.java:101)<br><br><br><br>à org.apache.sling.resourceresolver.impl.ResourceResolverImpl.`<` init`>` (ResourceResolverImpl.java:94)<br><br><br><br>at org.apache.sling.resourceresolver.impl.CommonResourceResolverFactoryImpl.getResourceResolverInternal(CommonResourceResolverFactoryImpl.java:263)<br><br><br><br>at org.apache.sling.resourceresolver.impl.CommonResourceResolverFactoryImpl.getResourceResolver(CommonResourceResolverFactoryImpl.java:173)<br><br><br><br>à org.apache.sling.resourceresolver.impl.ResourceResolverFactoryImpl.getResourceResolver(ResourceResolverFactoryImpl.java:105)<br><br><br><br>à com.day.cq.search.impl.builder.QueryBuilderImpl.createResourceResolver(QueryBuilderImpl.java:210)<br><br><br><br>à com.day.cq.search.impl.builder.QueryImpl.getResourceResolver(QueryImpl.java:231)<br><br><br><br>à com.day.cq.search.impl.result.HitImpl.getResource(HitImpl.java:108)<br><br><br><br>à com.day.cq.search.writer.SimpleHitWriter.writeSimpleJson(SimpleHitWriter.java:54)<br><br><br><br>à com.day.cq.search.writer.SimpleHitWriter.write(SimpleHitWriter.java:41)<br><br><br><br>à com.day.cq.search.impl.servlets.QueryBuilderJsonServlet.writeHits(QueryBuilderJsonServlet.java:165)<br><br><br><br>à com.day.cq.search.impl.servlets.QueryBuilderJsonServlet.handleQuery(QueryBuilderJsonServlet.java:113)<br><br><br><br>à com.day.cq.search.impl.servlets.QueryBuilderJsonServlet.doGet(QueryBuilderJsonServlet.java:73)<br><br><br><br>at org.apache.sling.api.servlets.SlingSafeMethodsServlet.mayService(SlingSafeMethodsServlet.java:270)<br><br><br><br>at org.apache.sling.api.servlets.SlingAllMethodsServlet.mayService(SlingAllMethodsServlet.java:140)<br><br><br><br>at org.apache.sling.api.servlets.SlingSafeMethodsServlet.service(SlingSafeMethodsServlet.java:346)<br><br><br><br>at org.apache.sling.api.servlets.SlingSafeMethodsServlet.service(SlingSafeMethodsServlet.java:378)<br><br><br><br>à org.apache.sling.engine.impl.request.RequestData.service(RequestData.java:552)<br><br><br><br>à org.apache.sling.engine.impl.filter.SlingComponentFilterChain.render(SlingComponentFilterChain.java:44)<br><br>

## Résolution {#resolution}


Sur les sites AEM actifs, il est recommandé que <b>/bin/querybuilder</b> Les URL sont bloquées par le Dispatcher.

Ces URL peuvent être utilisées en toute sécurité sur les instances d’auteur (orientées réseau interne), mais sur les sites en ligne, cela peut ouvrir le système à la divulgation des données.

La solution à ce bogue consiste à éviter d’utiliser le<b> /bin/querybuilder</b> servlet et utilisez plutôt le <b>API QueryBuilder</b>.

Après avoir appelé l’API , fermez manuellement le <b>ResourceResolver </b>après avoir traité le résultat de la requête.

Veuillez trouver l’exemple de code [ici.](https://github.com/Adobe-Consulting-Services/acs-aem-samples/blob/master/bundle/src/main/java/com/adobe/acs/samples/search/querybuilder/impl/SampleQueryBuilder.java#L195) Par exemple, voici des résolveurs de ressources avec fuite de code :
<br> <br>Requête = queryBuilder.createQuery(..., session);<br>SearchResult = query.getResult();<br><b>pour</b> (Accès : result.getHits()) {<br>// <b>faire</b> certains traitements<br>}<br>
Code de solution :
<br> <br> <br>// solution : fermez le résolveur de ressources interne<br>Itérateur`<` Ressource`>`  resources = result.getResources();<br><b>si</b> (resources.hasNext()) {<br>resources.next().getResourceResolver().close();<br>}