---
title: Optimisation du cache de  [!DNL Dispatcher]
description: Description
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: 10/20/2021 7:12:29 PM
article-published-by: Cedric Latimier
article-published-date: 1/18/2022 1:45:44 PM
version-number: 1
article-number: KA-17458
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=ee6e74a7-d931-ec11-b6e5-000d3a5ba97a
exl-id: 84871fce-d53d-4a1d-aabf-ccf8c8c47810
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '1411'
ht-degree: 100%

---

# Optimisation du cache de [!DNL Dispatcher]

## Description


Cet article se concentre sur les dernières optimisations du Dispatcher AEM et sur la manière de les exploiter au mieux.  Le Dispatcher AEM est un serveur [proxy inverse](https://stackoverflow.com/questions/224664/difference-between-proxy-server-and-reverse-proxy-server) de mise en cache conçu pour être utilisé avec Adobe Experience Manager.  Il peut être installé et exécuté en tant que module dans les logiciels de serveur web existants.  Au moment de la rédaction du présent article, le [module dispatcher est pris en charge](https://helpx.adobe.com/fr/experience-manager/dispatcher/using/dispatcher-install.html) sur [!DNL Apache HTTP Server], Microsoft IIS et [!DNL iPlanet].


## Résolution

<br><br>Fonctionnement de la mise en cache du Dispatcher<br><br><br><br><br><br>
Au niveau le plus élémentaire, le Dispatcher AEM est un proxy inverse qui fonctionne en exécutant la mise en cache, le vidage du cache et l’invalidation du cache.

Pour plus d’informations sur le Dispatcher, voir les liens connexes :

1. [Fonctionnement du Dispatcher et procédure d’installation](https://helpx.adobe.com/fr/experience-manager/dispatcher/using/dispatcher.html).
2. [Options de configuration disponibles dans le Dispatcher](https://helpx.adobe.com/fr/experience-manager/dispatcher/using/dispatcher-configuration.html).
3. [Webinaire sur le fonctionnement du Dispatcher](https://github.com/cqsupport/webinar-dispatchercache) - notez que certaines informations de la présentation sont basées sur les anciennes versions du Dispatcher.
4. [Session de webinaire Gems sur les fonctionnalités du Dispatcher, l’utilisation et la sécurité du réseau CDN](https://docs.adobe.com/ddc/fr/gems/dispatcher-caching---new-features-and-optimizations.html).
5. [Session Gems sur les nouvelles fonctionnalités du Dispatcher (version ultérieure à la version 4.1.9)](https://helpx.adobe.com/fr/experience-manager/kt/eseminars/gems/aem-dispatcher.html).

<br><br><br><br><br><br>Optimisation du cache du Dispatcher<br><br><br><br><br><br>
Voici plusieurs façons d’optimiser le cache du Dispatcher :

1. <b>Mettre en cache presque tout</b> - cela signifie mettre en cache tout contenu qui serait demandé plus d’une fois par les utilisateurs.
2. <b>Mettre en cache du contenu personnalisé pour différentes périodes</b> - Si votre site comporte du contenu personnalisé, envisagez d’utiliser [[!DNL Apache Sling Dynamic Includes]](https://experienceleague.adobe.com/docs/experience-manager-learn/foundation/development/set-up-sling-dynamic-include.html?lang=fr) dans votre application AEM pour tirer parti de [!DNL Ajax] (Appels JavaScript et XML asynchrones au niveau du navigateur), SSI (Server Side Includes au niveau du serveur web) et ESI (Edge-side Includes au niveau du réseau CDN) pour mettre en cache différentes parties de la page pendant différentes périodes.
3. <b>Ne jamais supprimer le cache du Dispatcher sur un Dispatcher dynamique</b> - Si un Dispatcher diffuse du contenu dynamique et que vous supprimez le cache, cela provoquera un flot massif de demandes de retour à AEM.  En conséquence, le cache du Dispatcher ne doit jamais être supprimé sur un Dispatcher dynamique.
4. <b>Supprimer le cache </b>- Avant de supprimer le cache [!DNL Dispatcher], extrayez le [!DNL Dispatcher] de votre répartition de charge, supprimez le cache, puis exécutez un outil de moteur de recherche Web pour mettre en cache les fichiers sur le Dispatcher avant de le placer sur la répartition de charge.
5. <b>Mettre en cache les pages d’erreur</b> - Tirez parti de la directive <b>[DispatcherPassError 1](https://helpx.adobe.com/fr/experience-manager/dispatcher/using/dispatcher-install.html#ApacheWebServer) </b>(spécifique au serveur web [!DNL Apache]) pour traiter les pages d’erreur, telles que les erreurs 404 depuis le cache du Dispatcher.
6. <b>Compresser au format GZip tous les types de fichiers à l’exception de ceux qui sont pré-compressés </b>- Dans le serveur Web [!DNL Apache], [mod_deflate](https://httpd.apache.org/docs/2.4/mod/mod_deflate.html) peut être utilisé, mais assurez-vous que l’en-tête <b>`Vary: User-Agent` </b>n’est<b> </b>pas défini.  Dans Microsoft IIS, utilisez [Compression dynamique](https://docs.microsoft.com/fr-fr/iis/configuration/system.webserver/httpcompression/).

   Exemple de configuration [!DNL Apache] (en spécifiant uniquement certains types de contenu pour éviter les types de fichiers précompressés) :

   `AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript`
7. <b>Activer [/serveStaleOnError](https://helpx.adobe.com/fr/experience-manager/kb/ServeStaleContentOnError.html)</b> dans la configuration `/cache` - traitez l’ancien fichier cache lorsque les instances AEM traitent des erreurs.
8. <b>Ajoutez [/gracePeriod](https://docs.adobe.com/content/help/fr/experience-manager-dispatcher/using/configuring/dispatcher-configuration.html#configuring-the-dispatcher-cache-cache)</b> à la configuration `/cache` - définissez le nombre de secondes pendant lesquelles une ressource obsolète et invalidée automatiquement peut toujours être traitée à partir du cache après le dernier événement de publication de contenu (« activation »).  Cela réduit le nombre de requêtes qui reviennent aux instances de publication lors d’une activité de publication de contenu importante, telle qu’une « Activation d’arborescence ».
9. <b>Ajouter des règles à [/ignoreUrlParams](https://helpx.adobe.com/fr/experience-manager/dispatcher/using/dispatcher-configuration.html#IgnoringURLParameters)</b> - ignorez les paramètres de chaîne de requête qui ne sont pas obligatoires ou utilisés par l’application.  Cela permet la mise en cache des URL même lorsqu’une chaîne de requête est présente.
10. <b>Mettre en cache des en-têtes de réponse Cache-Control et Last-Modified</b> - Utilisez la configuration <b> [/headers](https://helpx.adobe.com/fr/experience-manager/dispatcher/using/dispatcher-configuration.html#CachingHTTPResponseHeaders)</b> pour mettre en cache les en-têtes de réponse HTTP <b>`Cache-Control`</b> et <b>`Last-Modified` </b>(et/ou l’en-tête <b>`ETag`</b> si vous l’envoyez à partir d’AEM).  Cela permet de simplifier et d’optimiser la mise en cache au niveau du réseau CDN et du navigateur.  La mise en cache de ces en-têtes permet que seul AEM définisse les en-têtes, et non le serveur web lui-même.  Notez que lorsque vous procédez de la sorte, vous devez commencer à envoyer les en-têtes à partir de votre application AEM.
11. <b>Mettre en cache le contenu aussi longtemps que possible</b> et <b>réduire les requêtes qui reviennent à AEM</b> - Optimisez les requêtes de vidage en activant le vidage [refetching](https://helpx.adobe.com/experience-manager/kb/optimizing-the-dispatcher-cache.html#refetching-flush) sur tous les agents de vidage.  Ou utilisez [<b>/enableTTL</b>](https://helpx.adobe.com/experience-manager/kb/optimizing-the-dispatcher-cache.html#use-ttls) et définissez l’en-tête <b>`Cache-Control: max-age=...`</b> pour mettre en cache les fichiers aussi longtemps que possible.  Voir [ci-dessous](https://helpx.adobe.com/experience-manager/kb/optimizing-the-dispatcher-cache.html#use-ttls) pour plus d’informations sur cette rubrique.

<br><br><br><br><br><br>Utiliser les TTL<br><br><br><br><br><br>
À partir de la version 4.1.11 du [!DNL Dispatcher], [/enableTTL 1](https://helpx.adobe.com/fr/experience-manager/dispatcher/using/dispatcher-configuration.html#ConfiguringTimeBasedCacheInvalidationenableTTL) peut être défini dans la configuration des fichiers `.any`.  Ce paramètre permet au Dispatcher de respecter les expirations du cache définies dans l’en-tête de réponse HTTP `Cache-Control`.  En d’autres termes, le Dispatcher fonctionnera comme un réseau CDN où une forme principale d’invalidation du cache se produit lorsque les fichiers expirent.  Une fois que vous avez implémenté ceci et que vous avez commencé à envoyer <b>`Cache-Control: max-age=...` </b>pour toutes les réponses d’AEM, vous pouvez désactiver en toute sécurité vos agents de vidage du Dispatcher dans les instances de publication.

Après avoir désactivé les agents de vidage sur les instances de publication, vous pourriez vouloir vider le cache du Dispatcher.  Dans ce cas, vous pouvez utiliser [ACS Commons - Dispatcher Flush UI](https://adobe-consulting-services.github.io/acs-aem-commons/features/dispatcher-flush-ui/index.html).  Cet outil est installé sur l’instance de création.  Il fournit aux utilisateurs une interface utilisateur dans laquelle ils peuvent exécuter des requêtes de vidage de cache manuel.

<b>I. Étapes pour activer les invalidations de style TTL (« Time to Live » ou expiration) :</b>

1. Modifier le code source dans l’application AEM pour envoyer l’en-tête <b>`Cache-Control` </b>et <b>`Last-Modified` </b>pour toutes les requêtes pour lesquelles il n’est pas déjà défini.
2. Installez [!DNL Dispatcher] version 4.1.11 ou ultérieure.
3. Définissez <b>[/enableTTL 1](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-configuration.html#ConfiguringTimeBasedCacheInvalidationenableTTL)</b> dans la configuration de la ferme `.any` du site.
4. Définissez la configuration <b>[/headers](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-configuration.html#CachingHTTPResponseHeaders) </b>pour mettre en cache les en-têtes <b>`Cache-Control`</b> et <b>`Last-Modified`</b>.
5. Redémarrez le serveur web.


<b>II. Désactivez les agents de vidage du Dispatcher sur les instances de publication :</b>.

Le Dispatcher utilise désormais l’en-tête `Cache-Control` pour contrôler l’invalidation des fichiers cache.  Comme c’est le cas, le vidage du Dispatcher à partir des instances de publication n’est plus nécessaire.

1. Accédez à `/etc/replication/agents.publish.html` sur chaque instance de publication.
2. Accédez à la configuration de chaque agent de vidage et désactivez l’agent.


<b>III. Autorisez les requêtes de vidage manuel du Dispatcher à partir de l’instance de création :</b>.

Maintenant que les agents de vidage sont désactivés, vous pouvez vous reposer entièrement sur l’en-tête <b>`Cache-Control` </b> pour contrôler le moment où le contenu est actualisé sur le Dispatcher.  Vous pouvez toujours permettre aux utilisateurs d’effectuer des vidages manuels du cache du Dispatcher :

1. Installer [ACS Commons - Dispatcher Flush UI](https://adobe-consulting-services.github.io/acs-aem-commons/features/dispatcher-flush-ui/index.html) sur l’instance de création.
2. Configurez les agents de vidage sur l’instance de création.
3. Dans chacune des configurations de l’agent, activez l’option <b>Triggers</b> = <b>Ignorer la valeur par défaut</b>. Cette option permet aux agents de vidage d’ignorer les utilisateurs qui cliquent sur <b>Publier/Annuler la publication</b> ou <b>Activer/Désactiver</b> dans l’interface utilisateur d’AEM.

<br><br><br><br><br><br>Récupérer le vidage du Dispatcher<br><br><br><br><br><br>
Pour optimiser les requêtes de vidage du Dispatcher, tous les agents de vidage du Dispatcher doivent avoir une fonctionnalité appelée ‘Récupération du vidage activée’.

Pour activer la récupération du vidage du Dispatcher, procédez comme suit :

1. Accédez à <b>*http://aemhost:port*/crx/packmgr/index.jsp</b> et connectez-vous en tant qu’administrateur.
2. Téléchargez le package [ici](https://github.com/cqsupport/webinar-dispatchercache/blob/master/packages/dispatcher-flush-refetch-samplecode-1.0.zip?raw=true).
3. Téléchargez et installez le package dans le gestionnaire de packages.
4. Accédez à la configuration de l’agent de vidage du Dispatcher. Par exemple <b>/etc/replication/agents.author/flush.html</b>
5. Cliquez sur <b>[!UICONTROL Modifier]</b>.
6. Définissez les éléments suivants :
   - <b>Type de sérialisation</b> = <b>Récupérer le vidage du Dispatcher</b>
   - <b>Étendu</b> = <b>Méthode HTTP</b> = <b>POST</b>
7. Cliquez sur <b>[!UICONTROL Enregistrer]</b>.


Notez que le package installé ci-dessus n’est qu’un exemple de base.  Pour personnaliser et optimiser la récupération du vidage, vous pouvez modifier la liste des URI qu’il envoie.  Le code est en open source et se trouve [ici](https://github.com/cqsupport/webinar-dispatchercache/tree/master/src/refetching-flush-agent/refetch-bundle).  Le code ajoute une liste d’URI au corps de la requête en tant que paramètres indiquant au Dispatcher les chemins à récupérer.  Vous pouvez ajouter d’autres chemins en fonction des exigences de votre application afin d’optimiser les fonctionnalités de mise en cache de votre site.
<br><br><br><br><br><br>Une explication plus détaillée de la récupération du vidage<br><br><br><br><br><br>
Normalement, un vidage du Dispatcher fonctionne en supprimant des fichiers :

1. Touchez les fichiers `.stat`.
2. Supprimez `/content/foo.\*`.
3. Supprimez `/content/foo/_jcr_content`.


En raison du fait que les fichiers sont supprimés à l’étape 2, la prochaine fois qu’un utilisateur demande un fichier comme `/content/foo.html` ou `/content/foo.json`, tandis que le fichier est « récupéré à nouveau », les requêtes suivantes pour le même fichier sont également envoyées aux instances de publication jusqu’à ce que le fichier soit mis en cache.  Pour les réponses lentes ou les pages à trafic élevé, telles que les pages d’accueil, cela peut entraîner une inondation du niveau de l’instance de publication.

Pour résoudre ce problème, activez une fonctionnalité du Dispatcher appelée ‘Récupérer à nouveau’.  Cette fonctionnalité vous permet d’envoyer une liste d’URI que le Dispatcher doit « récupérer à nouveau » de manière proactive et remplacer plutôt que de supprimer.

Voir 22:41-27:05 dans cet [enregistrement de présentation](https://my.adobeconnect.com/p7th2gf8k43) pour une démonstration de son fonctionnement et de sa configuration.
