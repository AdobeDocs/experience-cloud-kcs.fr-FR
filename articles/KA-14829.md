---
title: Campaign Classic V7 - Qu’est-ce que le module db pg_stat_statement ? À quoi sert-il ?
description: Description
solution: Campaign,Campaign Classic v7
product: Campaign,Campaign Classic v7
applies-to: Campaign Classic,Campaign,Campaign Classic v7
keywords: KCS
resolution: Resolution
internal-notes: https://wiki.corp.adobe.com/pages/viewpage.action?spaceKey=neolane&title=Database+performance+optimization+-+Identify+bottleneck+queries+with+execution+statistics#Databaseperformanceoptimization-Identifybottleneckquerieswithexecutionstatistics-pg_stat_statements
bug: false
article-created-by: Marta Zator
article-created-date: 5/4/2022 4:36:53 PM
article-published-by: Marta Zator
article-published-date: 5/4/2022 4:38:25 PM
version-number: 2
article-number: KA-14829
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=aa74c765-c8cb-ec11-a7b5-6045bd00d4f5
exl-id: ad0f34e4-bf33-4eef-a290-7b0a3e92a6c9
source-git-commit: e8f4ca2dd578944d4fe399074fab461de88ad247
workflow-type: tm+mt
source-wordcount: '350'
ht-degree: 1%

---

# Campaign Classic V7 - Qu’est-ce que le module db pg_stat_statement ? À quoi sert-il ?

## Description


1. Qu’est-ce que le module db pg_stat_statement ?

2. Pourquoi l’activation est-elle demandée par les clients ?

3. Comment est-il activé ?






## Résolution




1.  Le module pg_stat_statement fournit un moyen pour suivre les statistiques d&#39;exécution de toutes les instructions SQL exécutées par un serveur.

Le module doit être chargé en ajoutant pg_stat_statement à shared_preload_library dans postgresql.conf, car il nécessite une mémoire partagée supplémentaire. Cela signifie qu’un redémarrage du serveur est nécessaire pour ajouter ou supprimer le module.

Lien : [https://www.postgresql.org/docs/9.4/pgstatstatements.html](https://www.postgresql.org/docs/9.4/pgstatstatements.html)



2. Pour mettre en oeuvre un schéma de type vue sur cette table qui nous permet de suivre les requêtes qui prennent du temps. Les clients pourront ainsi les régler et optimiser les performances.

Cette extension fournit des mesures sur l’exécution des requêtes : qui sont les requêtes les plus fréquemment exécutées et la durée de chacune d’elles.



3.  <b>pg_stat_statement </b>

1. Vérifiez que le package de contrib PostgreSQL officiel pour la version postgres est installé.

$ dpkg -l | grep postgres postgresql-contrib-9.3

S’il n’est pas installé, installez-le.

$ apt-get install postgresql-contrib-9.3

2. Modifier postgresql.conf pour précharger le module au démarrage

Valeur par défaut : shared_preload_Librairies = &#39;&#39; Nouveau : shared_preload_library = &#39;pg_stat_statement&#39; — si vous utilisez à la fois pg_stat_instructions et auto_explication, utilisez un enregistrement ONE et séparez-le par des virgules shared_preload_library = &#39;auto_explication,pg_stat_instructions&#39;

3. Dans la base de données que vous souhaitez surveiller, exécutez la requête CREATE :

— aucune création d’extension requise pour auto_explication, uniquement pour pg_stat_statement psql postgres=# \c mydatabase=# CREATE EXTENSION pg_stat_instructions;

4. Dans la section OPTIONS personnalisées du fichier postgresql.conf, ajoutez les lignes :

pg_stat_statement.max = 5000 pg_stat_statement.track = all pg_stat_statement.save = on

5. Redémarrez l’exemple de service postgresql : Obtenir les 5 requêtes les plus coûteuses dans les bases de données

SELECT query, calls, total_time, rows, 100.0\*shared_blks_hit/nullif(shared_blks_hit+shared_blks_read,0) AS hit_percent from pg_stat_instructions as s inner join pg_database as d on d.oid = s.dbid où d.datname = &#39;Database_Name&#39; order by total_time desc ;
