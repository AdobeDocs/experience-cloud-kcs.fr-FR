---
title: « Comment exécuter une vérification de cohérence de magasin de données via oak-run »
description: Description
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: « KCS »
resolution: Resolution
internal-notes: "Helpx Link: https://helpx.adobe.com/experience-manager/kb/How-to-run-a-datastore-consistency-check-via-oak-run-AEM.html"
bug: false
article-created-by: Cedric Latimier
article-created-date: "1/10/2023 9:20:59 AM"
article-published-by: Cedric Latimier
article-published-date: "1/10/2023 9:21:59 AM"
version-number: 5
article-number: KA-16550
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=2863b416-c890-ed11-aad1-6045bd006268"
source-git-commit: a02880ad907e781ff9691c24c6c35a5a1e8d206c
workflow-type: tm+mt
source-wordcount: '330'
ht-degree: 59%

---

# Comment exécuter une vérification de cohérence de magasin de données via oak-run

## Description {#description}

<br>Environnement<br><br>
- Adobe Experience Manager 6.4
- Oak 1.8.8 et versions ultérieures



<b>Problème/Symptômes</b>
L’outil oak-run est utile lorsque vous constatez une erreur comme celle-ci :


| `09.11.2017 13:42:17.512 *WARN* async-index-update-async org.apache.jackrabbit.oak.plugins.blob.datastore.DataStoreBlobStore Error occurred while loading bytes from steam while fetching for id record ID`<br><br>`java.util.concurrent.ExecutionException: java.io.IOException: org.apache.jackrabbit.core.data.DataStoreException: Record record ID does not exist`<br><br>`Caused by: java.io.IOException: org.apache.jackrabbit.core.data.DataStoreException: Record record ID does not exist` |
| --- |



|  |
| --- |

<br>Contrairement au` /system/console/repositorycheck` Dans l’interface utilisateur, l’outil exécuté par Oak vérifie les fichiers d’index Lucene masqués sous `/oak:` en plus du reste des chemins d’accès au contenu.  Cet outil vous offre la possibilité de restaurer les fichiers d’index dans le magasin de données ou de reconstruire uniquement les index corrompus au lieu de les réindexer tous comme documenté [ici](https://helpx.adobe.com/experience-manager/kb/oak-blobstore-inconsistency-blobId.html).

## Résolution {#resolution}


1. [Téléchargez oak-run jar 1.8.8 ou une version ultérieure](https://repo1.maven.org/maven2/org/apache/jackrabbit/oak-run/1.6.6/oak-run-1.6.6.jar) sur votre serveur AEM.
2. Exécutez la commande ci-dessous (mais remplacez les chemins d’accès au magasin de segments et de données pour qu’ils correspondent à votre environnement) :

   <b>`java -jar oak-run-*.jar datastorecheck --consistency --ref --id --fds crx-quickstart/install/org.apache.jackrabbit.oak.plugins.blob.datastore.FileDataStore.config --repoHome crx-quickstart/repository --store crx-quickstart/repository/segmentstore --dump temp --verbose --track`</b>


3. La commande génère une vérification de cohérence du magasin de données.
4. À l’aide de la sortie, suivez l’[article](https://helpx.adobe.com/experience-manager/kb/oak-blobstore-inconsistency-blobId.html) pour restaurer ou corriger les fichiers manquants.


Le vérificateur de cohérence du magasin de données peut également être utilisé pour répertorier toutes les références d’objets Blob dans le magasin de nœuds et tous les identifiants d’objets Blob disponibles dans le magasin de données. Utilisez la commande suivante :

`$ java-jar oak-run-*.jar datastorecheck --id --ref --consistency \`

`--store | \`

`--s3ds |--fds \`

`--dump \`

`--track`

Fournissez une ou plusieurs des options suivantes :

- —id : répertorie tous les identifiants de l’entrepôt de données.
- —ref : répertorie toutes les références d’objets Blob dans le magasin de noeuds.
- —consistency : Liste tous les objets Blob manquants en effectuant une vérification de cohérence.


Les options suivantes sont facultatives :

- —store - Chemin d’accès à l’entrepôt de segments de mongo uri (Obligatoire pour les options —ref et —consistency ci-dessus).
- —dump : chemin d’accès où vider les fichiers (facultatif). Dans le cas contraire, les fichiers sont vidés dans le répertoire tmp de l’utilisateur.
- —s3ds - Chemin d’accès au fichier de configuration S3DataStore.
- —fds - Chemin d’accès au fichier de configuration FileDataStore (la propriété &#39;path&#39; est obligatoire).
- —track : chemin d’accès au dossier d’accueil du référentiel local (facultatif). Cela place une copie des identifiants d’objets blob téléchargés à suivre.


<b>Autres informations similaires</b>

[Vérification du magasin de données Oak](https://github.com/apache/jackrabbit-oak/tree/1.8/oak-run#oak-datastore-check)
