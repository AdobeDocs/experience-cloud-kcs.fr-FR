---
title: "Comment exécuter une vérification de cohérence de banque de données via oak-run"
description: Description
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: "KCS"
resolution: Resolution
internal-notes: "Helpx Link: https://helpx.adobe.com/experience-manager/kb/How-to-run-a-datastore-consistency-check-via-oak-run-AEM.html"
bug: false
article-created-by: Tanay Sharma .
article-created-date: "10/18/2022 7:46:50 AM"
article-published-by: Tanay Sharma .
article-published-date: "10/18/2022 8:00:10 AM"
version-number: 4
article-number: KA-16550
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=2cd5c202-b94e-ed11-bba2-0022480868ff"
source-git-commit: 71f0dff4684d778d04a05ddefd68c941da7e17a1
workflow-type: tm+mt
source-wordcount: '330'
ht-degree: 7%

---

# Comment exécuter une vérification de cohérence de banque de données via oak-run

## Description

<br>Environnement<br>
- Adobe Experience Manager 6.4
- Oak 1.8.8 et versions ultérieures



<b>Problème/Symptômes</b>
L’outil oak-run est utile lorsque vous constatez une erreur comme celle-ci :


| `09.11.2017 13:42:17.512 *WARN* async-index-update-async org.apache.jackrabbit.oak.plugins.blob.datastore.DataStoreBlobStore Error occurred while loading bytes from steam while fetching for id 4089b47c7ba7ab8015859428e7e6965eec4641e3#241`<br><br>`java.util.concurrent.ExecutionException: java.io.IOException: org.apache.jackrabbit.core.data.DataStoreException: Record 4089b47c7ba7ab8015859428e7e6965eec4641e3 does not exist`<br><br>`Caused by: java.io.IOException: org.apache.jackrabbit.core.data.DataStoreException: Record 4089b47c7ba7ab8015859428e7e6965eec4641e3 does not exist` |
| --- |



|  |
| --- |

<br>Contrairement au` /system/console/repositorycheck` Dans l’interface utilisateur, l’outil exécuté par Oak vérifie les fichiers d’index Lucene masqués sous `/oak:` en plus du reste des chemins d’accès au contenu.  Cet outil vous offre la possibilité de restaurer les fichiers d’index dans la banque de données ou de reconstruire uniquement les index corrompus au lieu de les réindexer tous comme documentés. [here](https://helpx.adobe.com/experience-manager/kb/oak-blobstore-inconsistency-blobId.html).

## Résolution


1. [Télécharger oak-run jar 1.8.8 ou version ultérieure](https://repo1.maven.org/maven2/org/apache/jackrabbit/oak-run/1.6.6/oak-run-1.6.6.jar) à votre serveur AEM.
2. Exécutez la commande ci-dessous (mais remplacez les chemins d’accès par segment et banque de données pour qu’ils correspondent à votre environnement) :

   <b>`java -jar oak-run-*.jar datastorecheck --consistency --ref --id --fds crx-quickstart/install/org.apache.jackrabbit.oak.plugins.blob.datastore.FileDataStore.config --repoHome crx-quickstart/repository --store crx-quickstart/repository/segmentstore --dump temp --verbose --track`</b>


3. La commande génère une vérification de cohérence de banque de données.
4. À l’aide de la sortie, suivez [article](https://helpx.adobe.com/experience-manager/kb/oak-blobstore-inconsistency-blobId.html) pour restaurer ou corriger les fichiers manquants.


Le vérificateur de cohérence de l’entrepôt de données peut également être utilisé pour répertorier toutes les références d’objets Blob dans l’entrepôt de noeuds et tous les identifiants d’objets Blob disponibles dans l’entrepôt de données. Utilisez la commande suivante :

`$ java-jar oak-run-*.jar datastorecheck --id --ref --consistency \`

`--store | \`

`--s3ds |--fds \`

`--dump \`

`--track`

Fournissez une ou plusieurs des options suivantes :

- —id : répertorie tous les identifiants de l’entrepôt de données.
- —ref : répertorie toutes les références d’objets Blob dans le magasin de noeuds.
- —consistency : Liste tous les objets Blob manquants en effectuant une vérification de cohérence.


Les options suivantes sont facultatives :

- —store - Chemin d’accès à l’entrepôt de segments de mongo uri (Obligatoire pour les options —ref et —consistency ci-dessus).
- —dump : chemin d’accès où vider les fichiers (facultatif). Dans le cas contraire, les fichiers sont vidés dans le répertoire tmp de l’utilisateur.
- —s3ds - Chemin d’accès au fichier de configuration S3DataStore.
- —fds - Chemin d’accès au fichier de configuration FileDataStore (la propriété &#39;path&#39; est obligatoire).
- —track : chemin d’accès au dossier d’accueil du référentiel local (facultatif). Il place une copie des identifiants d’objets blob téléchargés à suivre.


<b>Autres informations similaires</b>

[Vérification de la banque de données Oak](https://github.com/apache/jackrabbit-oak/tree/1.8/oak-run#oak-datastore-check)
